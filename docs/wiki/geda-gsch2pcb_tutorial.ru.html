<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
  <link rel="stylesheet" media="screen" type="text/css" href="./style.css" />
  <link rel="stylesheet" media="screen" type="text/css" href="./design.css" />
  <link rel="stylesheet" media="print" type="text/css" href="./print.css" />

  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
</head>
<body>

<p>
<em>Эта страница доступна также на следующих языках:</em>
<a href="geda-gsch2pcb_tutorial.html" class="wikilink1" title="geda-gsch2pcb_tutorial.html">English</a>
</p>

<h1 class="sectionedit1" id="gschem_-_gsch2pcb_-_pcb">gschem -&gt; gsch2pcb -&gt; pcb</h1>
<div class="level1">

<p>
Это учебник по использованию <strong>gsch2pcb</strong> как интерфейса между <strong>gschem</strong> и
<strong>pcb</strong>. Мы предполагаем, что пакеты <strong>gEDA</strong>, <strong>pcb</strong> и <strong>gsch2pcb</strong> у вас
уже установлены и готовы к работе. Начиная с <strong>gEDA 20030901</strong>, программа
<strong>gsch2pcb</strong> находится в одном пакете с другими программами gEDA и не
нуждается в отдельной установке. Настоящий учебник функционален и нацелен на
получение как можно более быстрых результатов. Хотя он и не является полным
справочным руководством по <strong>gschem</strong> или <strong>pcb</strong>, но на примере простого
проекта показывает все шаги, которые вы могли бы предпринять.
</p>

<p>
Цель учебника — научиться пользоваться <strong>gsch2pcb</strong> как мостом между
<strong>gschem</strong> и <strong>pcb</strong>, для того чтобы все добавления или удаления элементов
на <a href="geda-glossary.ru.html#принципиальная_схема" class="wikilink1" title="geda-glossary.ru.html">принципиальной схеме</a> в
<strong>gschem</strong> приводили бы к соответствующим автоматическим изменениям в
<a href="geda-glossary.ru.html#топология" class="wikilink1" title="geda-glossary.ru.html">топологической схеме</a> в <strong>pcb</strong>, то есть чтобы
топология печатной платы всегда соответствовала принципиальным
схемам. Обратное аннотирование изменений из <strong>pcb</strong> в <strong>gschem</strong> в настоящее
время невозможно.
</p>

<p>
История изменений настоящего документа находится в
<a href="geda-gsch2pcb_tutorial_releasenotes.ru.html" class="wikilink1" title="geda-gsch2pcb_tutorial_releasenotes.ru.html">замечаниях по выпуску</a>.
</p>

</div>
<!-- EDIT1 SECTION "gschem -> gsch2pcb -> pcb" [126-2181] -->
<h2 class="sectionedit2" id="терминология">Терминология</h2>
<div class="level2">

<p>
В <strong>gschem</strong> в принципиальную схему добавляют символы, изображающие
электронные компоненты. <em class="u"><a href="geda-glossary.ru.html#символ" class="wikilink1" title="geda-glossary.ru.html">Символ</a></em> — это группа из
выводов, атрибутов и линий, представляющая небольшое графическое изображение
<a href="geda-glossary.ru.html#компонент" class="wikilink1" title="geda-glossary.ru.html">электронного компонента</a> в электрической
схеме.  Выводы разных символов соединяют друг с другом, вычерчивая между
ними
<a href="geda-glossary.ru.html#соединение" class="wikilink1" title="geda-glossary.ru.html">соединения</a>.
<a href="geda-glossary.ru.html#атрибут" class="wikilink1" title="geda-glossary.ru.html">Атрибуты</a> — это именованные переменные,
прикрепляемые к символам и предназначенные для хранения некоторой
информации. Есть три атрибута, непосредственно относящихся к переводу
принципиальной схемы в топологическую, и они должны быть заданы.  Каждый
добавляемый в схему символ должен иметь атрибуты <code>footprint</code>, <code>value</code>, и
<code>refdes</code>.
</p>

<p>
Значение атрибута <code>footprint</code> (посадочное место) в принципиальной схеме
определяет для символа название pcb-элемента, которым данный экземпляр
символа должен быть представлен в топологии платы. <em class="u">pcb-элемент</em> — это
группа из выводов, контактных площадок и контуров <a href="geda-glossary.ru.html#слой_шелкографии" class="wikilink1" title="geda-glossary.ru.html">шелкографии</a>, соответствующая форме электронного
компонента. Есть два типа pcb-элементов и это, наверно, сбивает с толку
новичков в <strong>pcb</strong>. Есть исходные pcb-элементы, генерируемые макросами
<strong>m4</strong>, и, начиная с версии <strong>pcb</strong> 1.7, есть ещё и файловые элементы типа
<strong>newlib</strong>. <em class="u">Файловый элемент</em> — это один фиксированный элемент в одном
файле. В одном же файле <em class="u">m4-элементов</em> макроопределений элементов может
быть много. Чтобы получать программируемые элементы с разным количеством
выводов или изменяемыми размерами, для макросов могут задаваться
аргументы. В настоящем руководстве будет раскрыто использование этих двух
типов элементов и далее я так и буду называть их <em>m4-элементами</em> и
<em>файловыми элементами</em>.
</p>

<p>
При работе в <strong>pcb</strong>, если в меню <strong><em>Вид</em></strong> → <strong><em>Отображаемое название
элемента</em></strong> выбрать <strong>Описание</strong>, то как название элемента будет
отображаться значение атрибута <strong>gschem</strong> <code>footprint</code>. Дело в том, что
запись для каждого конкретного pcb-элемента в файле топологии содержит поле
<code>Описание</code> (<code>Description</code>), которое должно соответствовать посадочному
месту (<code>footprint</code>), и это соответствие отслеживается программой
<strong>gsch2pcb</strong>.
</p>

<p>
Значение атрибута <strong>gschem</strong> <code>refdes</code> — это <strong>позиционное обозначение</strong>
в схеме, такое как <em>Q1</em>, <em>U1</em>, <em>R1</em> и т. д.  Если в <strong>pcb</strong> в меню
<strong><em>Вид</em></strong> → <strong><em>Отображаемое название элемента</em></strong> выбрать <strong>Позиционное
обозначение</strong>, то как название элемента будет отображаться значение атрибута
<code>refdes</code>.
</p>

<p>
Значение атрибута <strong>gschem</strong> <code>value</code> — это <strong>значение</strong> (тип или
значение физической величины) конкретного компонента, такое как, например,
<em>BC546</em>, <em>7400</em>, <em>1K</em> и т. д.  Если в <strong>pcb</strong> в меню <strong><em>Вид</em></strong> →
<strong><em>Отображаемое название элемента</em></strong> выбрать <strong>Значение</strong>, то как название
элемента будет отображаться значение атрибута <code>value</code>.
</p>

</div>
<!-- EDIT2 SECTION "Терминология" [2182-7132] -->
<h2 class="sectionedit3" id="настройка">Настройка</h2>
<div class="level2">

<p>
При организации проектов разработки нужно учитывать структуру каталогов.
Пакеты <strong>gEDA</strong> и <strong>pcb</strong> по умолчанию предоставляют вам наборы символов
<strong>gschem</strong> и pcb-элементов, но можно создать и свои собственные библиотеки.
</p>
<ul>
<li class="level1"><div class="li"> Где-нибудь, может быть в своём домашнем каталоге, создайте структуру каталогов для своих проектов. Для своих каталогов вы можете придумать имена сами, в данном же учебнике я буду ссылаться на структуру каталогов, используемую мной: <pre class="code">gaf/
gaf/gschem-sym/                    Сюда я кладу свои символы gschem.
gaf/gschem-sym/transistors/        Можете организовать подкаталоги для своих символов.
gaf/pcb-elements/                  Сюда я кладу свои элементы pcb.
                                   Их также можно организовать с помощью подкаталогов.
gaf/myproject1/                    И, наконец, отдельные каталоги для каждого
gaf/myproject2/                    проекта.
...</pre>

<p>
 При такой организации любые ваши символы <strong>gschem</strong> и pcb-элементы могут быть общими для всех ваших проектов и это достаточно хорошо для начала работы.  Однако, я упомяну и другие возможности, которые будут описаны ниже: у вас могут быть подкаталоги <em>файловых элементов</em> или файлы <em>m4-элементов</em> <strong>pcb</strong> для конкретных проектов; кроме того, администраторы САПР могут настроить для общего пользования и локальные каталоги <em>файловых элементов</em>, и файлы <em>m4-элементов</em>.
</p>
</div>
</li>
<li class="level1"><div class="li"> <strong>Настройка gEDA:</strong> программы <strong>gschem</strong>, <strong>gnetlist</strong> и может быть другие, используемые вами, как например <strong>gattrib</strong>, должны иметь возможность найти любые создаваемые вами символы, поэтому этим программам нужно сказать, где лежат каталоги ваших символов для <strong>gschem</strong>, добавив строки <code>component-library</code> в файл <em><code>gafrc</code></em> — либо в файл, общий для проектов пользователя, <em><code>${HOME}/.gEDA/gafrc</code></em>, либо в файл <em><code>gafrc</code></em> в каталоге конкретного проекта. Есть ещё системный файл <em><code>${GEDADATA}/system-gafrc</code></em>, который могут настроить администраторы. Чтобы данные файлы можно было найти, должны быть соответственно установлены переменные окружения <code>HOME</code> и <code>GEDADATA</code>. Для описанной нами выше структуры каталогов в <em><code>${HOME}/.gEDA/gafrc</code></em> можно добавить следующие строки (а также строки и для других подкаталогов, которые вы бы хотели создать в <em><code>gschem-sym</code></em>): <pre class="code">(component-library &quot;${HOME}/gaf/gschem-sym&quot;)
(component-library &quot;${HOME}/gaf/gschem-sym/transistors&quot;)</pre>

<p>
 Или же файлы <em><code>gafrc</code></em> можно добавить в каталоги каждого из проектов (в такие как <em><code>myproject1</code></em> и <em><code>myproject2</code></em>, указанные выше) и прописать в них: 
</p>
<pre class="code">(component-library &quot;../gschem-sym&quot;)
(component-library &quot;../gschem-sym/transistors&quot;)</pre>

<p>
 Более современные версии gEDA (с 1.7.2) позволяют указать только одну команду для достижения этого: 
</p>
<pre class="code">(component-library-search &quot;../gschem-sym&quot;) </pre>

<p>
 которая рекурсивно просканирует все подкаталоги для символьных библиотек. Дальнейшие подробности настройки программ gEDA см. в <a href="geda-gschem_ug-config.ru.html" class="wikilink1" title="geda-gschem_ug-config.ru.html">Руководстве пользователя gEDA gschem</a>.
</p>
</div>
</li>
<li class="level1"><div class="li"> Если хочется более детальной настройки <strong>gschem</strong> и <strong>gnetlist</strong>, можно переопределить и другие начальные установки, заданные в глобальных rc-файлах. В Debian, чтобы узнать, что можно настроить, посмотрите rc-файлы в <em><code>/etc/gEDA/</code></em>. Мне, например, нравится светлый фон в <strong>gschem</strong>, поэтому я прописываю в свой <em><code>~/.gEDA/gschemrc</code></em> строку: <pre class="code">(load (build-path geda-rc-path &quot;gschem-colormap-lightbg&quot;)) ; light background</pre>
</div>
</li>
<li class="level1"><div class="li"> <strong>Настройка pcb:</strong> обычно пакет <strong>pcb</strong> настроен так, что <strong>pcb</strong> автоматически смотрит в подкаталог <em><code>packages</code></em> в рабочем каталоге. Поэтому, для того чтобы эта программа находила все элементы, лежащие у меня в каталоге <em><code>gaf/pcb-elements</code></em>, в каждом из каталогов своих проектов я делаю на него ссылку. Заметьте, что на самом деле эта ссылка при использовании <strong>gsch2pcb</strong> не обязательна, потому что, как будет показано ниже, альтернативно каталог <em><code>pcb-elements</code></em> можно прописать в <em>файле проекта</em>. Но если вы хотите такую ссылку сделать, перейдите в каталог <em><code>gaf/myproject1</code></em> и введите команду: <pre class="code">ln -s ../pcb-elements packages</pre>
</div>
</li>
<li class="level1"><div class="li"> <strong> Настройка gsch2pcb: </strong> В каждом из каталогов своих проектов создайте для <strong>gsch2pcb</strong> файл проекта, который можно называть как угодно, лишь бы имя не оканчивалось на <em>.sch</em>. Файл проекта мы создадим в примере ниже.</div>
</li>
</ul>

<p>
Вот и все настройки, которые нужны после исходной установки пакетов
<strong>gschem</strong>, <strong>gsch2pcb</strong> и <strong>pcb</strong>.
</p>

</div>
<!-- EDIT3 SECTION "Настройка" [7133-14136] -->
<h2 class="sectionedit4" id="простой_пример">Простой пример</h2>
<div class="level2">

<p>
Давайте настолько быстро, насколько это возможно, разработаем простой
проект, начиная с принципиальной схемы и заканчивая созданием топологии
печатной платы, и затем его можно будет использовать как основу для более
серьёзных вещей. Я сразу немного усложню этот проект, используя в нём две
принципиальных схемы.
</p>

<p>
Предположим, вы уже настроили структуру каталогов, как описано выше. Теперь
перейдите в каталог <em><code>gaf/myproject1</code></em> и создайте файл <em><code>project</code></em>,
содержащий следующее:
</p>
<pre class="code">schematics one.sch two.sch
output-name board</pre>

</div>
<!-- EDIT4 SECTION "Простой пример" [14137-15101] -->
<h3 class="sectionedit5" id="создание_схемы_onesch">Создание схемы one.sch</h3>
<div class="level3">

<p>
Если вы в <strong>gschem</strong> впервые, попробуйте сделать простую
<a href="geda-gschem_warmup.ru.html" class="wikilink1" title="geda-gschem_warmup.ru.html">разминку в gschem</a>.
</p>

<p>
<a href="media/geda/one-sch-1.png" class="media" target="_blank" title="geda:one-sch-1.png"><img src="media/geda/one-sch-1.png" class="medialeft" title="one.sch" alt="one.sch" /></a> Запустите <strong><code>gschem one.sch</code></strong> и создайте эту схему (на самом деле второй операционный усилитель здесь лишний, но ведь это просто учебник):
</p>
<ul>
<li class="level1"><div class="li"> Откройте диалоговое окно выбора компонентов (нажмите клавишу <kbd>I</kbd>)</div>
</li>
<li class="level1"><div class="li"> Убедитесь, что в выпадающем меню внизу диалогового окна установлено <strong>Поведение по умолчанию – ссылка на компонент</strong>.</div>
</li>
<li class="level1 node"><div class="li"> Добавьте компоненты:</div>
<ul>
<li class="level2"><div class="li"> Из библиотеки <strong>Basic devices</strong> три символа <em><code>resistor-1.sym</code></em> и два <em><code>dual-opamp-1.sym</code></em>.</div>
</li>
<li class="level2"><div class="li"> Из библиотеки <strong>Input/Output</strong> один <em><code>output-2.sym</code></em>.</div>
</li>
<li class="level2"><div class="li"> Из библиотеки <strong>Power rails</strong> один <em><code>gnd-1.sym</code></em>, два <em><code>vcc-1.sym</code></em> и два <em><code>vee-1.sym</code></em></div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> Разместите компоненты средней кнопкой мыши и поверните некоторые из них, выделив и нажав клавиши <kbd>E</kbd><kbd>R</kbd>, чтобы всё выглядело красиво. Поверните нижний операционный усилитель и зеркально отразите его, нажав <kbd>E</kbd><kbd>I</kbd>.</div>
</li>
<li class="level1"><div class="li"> С помощью клавиши <kbd>N</kbd> и мыши начертите соединения.</div>
</li>
</ul>

<p>
Большая рамка основной надписи также является компонентом. Для удобства она
заблокирована, чтобы предотвратить постоянный захват её мышью. Чтобы
разблокировать рамку, выделите её перемещением мыши, удерживая левую кнопку
нажатой, а затем нажмите <kbd>E</kbd> - <kbd>Shift</kbd>+<kbd>L</kbd>. В библиотеке
<strong>Titleblocks</strong> можно найти рамки основной надписи различных
размеров. Запомните, чтобы заблокировать новую рамку, её нужно выделить и
нажать <kbd>E</kbd><kbd>L</kbd>.
</p>

</div>
<!-- EDIT5 SECTION "Создание схемы one.sch" [15102-17617] -->
<h3 class="sectionedit6" id="редактирование_атрибутов_компонентов_в_схеме">Редактирование атрибутов компонентов в схеме</h3>
<div class="level3">

<p>
<a href="media/geda/one-sch-2.png" class="media" target="_blank" title="geda:one-sch-2.png"><img src="media/geda/one-sch-2.png" class="mediaright" title="one.sch" alt="one.sch" /></a> Для каждого из компонентов нужно сделать следующее: выделить его и вызвать окно атрибутов нажатием клавиш <kbd>E</kbd><kbd>E</kbd>. Атрибут <code>refdes</code> здесь менять не надо, а сделайте вот что:
</p>
<ul>
<li class="level1"><div class="li"> Для резисторов и операционных усилителей добавьте видимые атрибуты <code>value</code> и установите для них подходящие значения (<em>10K</em>, <em>TL072</em>). Расставьте их средней кнопкой мыши покрасивее. Если трудно их выбрать, увеличьте масштаб и опять действуйте средней кнопкой.</div>
</li>
<li class="level1"><div class="li"> Для резисторов добавьте атрибуты <code>footprint</code> и установите их значения в <em>R025</em> — это <em>m4-элемент</em> в <strong>pcb</strong> для 0,25-ваттных резисторов. Сделайте эти атрибуты невидимыми.</div>
</li>
<li class="level1"><div class="li"> Для операционных усилителей измените уже существующие атрибуты <code>footprint</code> на <em>DIL 8 300</em>. Да, пробелы здесь нужны, так как <em>DIL</em> является <em>m4-элементом</em>, принимающим два аргумента. Мы говорим ему сделать двухсторонний корпус DIL с 8 выводами шириной 300 милов. Измените атрибут <code>slot</code> второго операционного усилителя на <em>2</em>. Номера его выводов для входов/выходов должны измениться с (1,2,3) на (5,6,7).</div>
</li>
<li class="level1"><div class="li"> Для символа выходного <a href="geda-glossary.ru.html#порт" class="wikilink1" title="geda-glossary.ru.html">порта</a> установите атрибут <code>net</code> в <em>vmixer:1</em> и сделайте его видимым. Атрибут <code>value</code> для него установите в <em>Vmixer</em>.</div>
</li>
</ul>

<p>
Может быть вам показалось, что вот так редактировать схемы с большим
количеством компонентов, не имеющих приемлемых исходных значений атрибутов,
очень тяжело. Но есть пара способов облегчить этот труд, по крайней мере в
отношении посадочных мест. Можно создать свою библиотеку символов с такими
исходными значениями атрибутов <code>footprint</code> (и даже <code>value</code>), которые
подходят для большинства ваших задач. Или при добавлении первого компонента
для него сразу надо задавать подходящий корпус, а затем копировать его
(выделить компонент и нажать <kbd>E</kbd><kbd>C</kbd>), а не добавлять
остальные компоненты из библиотеки.
</p>

<p>
Так или иначе, пока мы закончили со схемой <em><code>one.sch</code></em>, так что
сохраните её, выбрав в меню <strong><em>Файл</em></strong> → <strong><em>Сохранить страницу</em></strong>, и
выйдите из <strong>gschem</strong>.
</p>

</div>
<!-- EDIT6 SECTION "Редактирование атрибутов компонентов в схеме" [17618-21156] -->
<h3 class="sectionedit7" id="создание_схемы_twosch">Создание схемы two.sch</h3>
<div class="level3">

<p>
Это будет на самом деле просто и глупо, так как здесь она нужна только для
демонстрации возможности работы с несколькими схемами.
<a href="media/geda/two-sch-1.png" class="media" target="_blank" title="geda:two-sch-1.png"><img src="media/geda/two-sch-1.png" class="medialeft" title="two.sch" alt="two.sch" /></a> Запустите <strong><code>gschem two.sch</code></strong>:
</p>
<ul>
<li class="level1"><div class="li"> Добавьте компонент <em><code>title-B.sym</code></em> таким же образом, как добавляли в <em><code>one.sch</code></em>.</div>
</li>
<li class="level1 node"><div class="li"> Добавьте компоненты:</div>
<ul>
<li class="level2"><div class="li"> Из библиотеки <strong>Input/Output</strong> один <em><code>input-2.sym</code></em>.</div>
</li>
<li class="level2"><div class="li"> Из библиотеки <strong>Basic Devices</strong> один <em><code>resistor-1.sym</code></em>.</div>
</li>
<li class="level2"><div class="li"> Из библиотеки <strong>Transistors</strong> один <em><code>2N3904-1.sym</code></em>.</div>
</li>
<li class="level2"><div class="li"> Из библиотеки <strong>Power rails</strong> один <em><code>gnd-1.sym</code></em>, один <em><code>vcc-1.sym</code></em> и один <em><code>vee-1.sym</code></em>.</div>
</li>
<li class="level2"><div class="li"> Из библиотеки <strong>Connectors</strong> один <em><code>BNC-1.sym</code></em>.</div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> Разместите компоненты и начертите соединения как и прежде.</div>
</li>
<li class="level1 node"><div class="li"> Отредактируйте атрибуты компонентов:</div>
<ul>
<li class="level2"><div class="li"> Входной порт: измените атрибут <code>net</code> так, чтобы он был невидимым и имел значение <em>vmixer:1</em>, так что это соединение будет подключено к <em>vmixer</em> в <em><code>one.sch</code></em>. Установите атрибут <code>value</code> в <em>Vmixer</em>.</div>
</li>
<li class="level2"><div class="li"> Резистор: установите для него невидимый атрибут <code>footprint</code> в <em>R025</em> и видимый атрибут <code>value</code> в <em>10K</em>.</div>
</li>
<li class="level2"><div class="li"> Транзистор: добавьте атрибут <code>value</code> со значением <em>2N3904</em> и невидимый атрибут <code>footprint</code> со значением <em>TO92</em>.</div>
</li>
<li class="level2"><div class="li"> BNC-коннектор: добавьте невидимый атрибут <code>footprint</code> <em>CONNECTOR 2 1</em>, что определяет <em>m4-элемент</em>, принимающий аргументы, и мы говорим ему сделать соединитель с двумя рядами и одним столбцом. Хотя в принципиальной схеме у нас BNC-коннектор, но на самом деле пусть он будет смонтирован на панели, а на плате будет фронтальный соединитель, с которого мы и кинем на него провода.</div>
</li>
</ul>
</li>
</ul>

<p>
К сожалению, неотъемлемой частью добавленного нами символа <em><code>2N3904</code></em>
является видимый текст «2N3904». Поэтому, когда мы добавляем атрибут
<code>value</code> (нужный нам для того, чтобы на топологической схеме отображались
соответствующие значения), на нашей принципиальной схеме видны два
обозначения, если не сделать атрибут <code>value</code> невидимым. Это нехорошо и в
данном примере нам придётся смириться с этим, но учтите, что в большинстве
случаев намертво прибивать информацию к символам — не очень хорошая
идея. Кроме того, атрибут <code>device</code> по умолчанию ошибочен и должен иметь
значение <em>NPN_TRANSISTOR</em>, но это не влияет на наше изложение. Это так,
для сведения, что сейчас в <strong>gschem</strong> есть символы, переносящие из старых
версий <strong>gschem</strong> в новые устаревшие методы работы с атрибутами. Если вам
придётся работать с этими схемами в <a href="geda-glossary.ru.html#spice" class="wikilink1" title="geda-glossary.ru.html">SPICE</a>, символы
должны иметь правильные атрибуты <code>device</code>.
</p>

<p>
Теперь мы закончили с принципиальными схемами, лишь не определили атрибуты
<code>refdes</code>, и можем воспользоваться командой <strong>refdes_renum</strong>, чтобы сделать
это для обеих схем сразу. Итак, сохраните <em><code>two.sch</code></em>, выйдите из
<strong>gschem</strong> и запустите:
</p>
<pre class="code">refdes_renum --pgskip one.sch two.sch</pre>

<p>
Откройте схемы в <strong>gschem</strong> снова и посмотрите, какие значения теперь заданы атрибутам <code>refdes</code> компонентов. Ключ <code>--pgskip</code> устанавливает начало нумерации в 101 для <em><code>one.sch</code></em> и в 201 для <em><code>two.sch</code></em>. Вам следует знать однако, что запуск <strong>refdes_renum</strong> на самом деле полезен только для первоначальной нумерации. Если позже вы станете менять свои схемы, добавлять или удалять компоненты, никто не даст гарантии, что при повторном запуске <strong>refdes_renum</strong> компоненты сохранят существующие значения <code>refdes</code>. Если тем временем вы с помощью <strong>gsch2pcb</strong> уже создали печатную плату, эта путаница с номерами позиционных обозначений приведёт к несоответствию ваших принципиальных схем топологии печатной платы. Поэтому после того как вы один раз запустите <strong>refdes_renum</strong> и начнёте заниматься разработкой топологии печатной платы, для безопасности (уникальные) атрибуты <code>refdes</code> для каждого из добавляемых компонентов лучше задавать вручную. Также учтите, что <strong>refdes_renum</strong> может пронумеровать ваши резисторы не так, как получилось здесь в моём примере, это зависит от порядка их добавления. Имейте это в виду, сравнивая свою окончательную топологию с той, которую увидите на приведённых ниже рисунках.
</p>

</div>
<!-- EDIT7 SECTION "Создание схемы two.sch" [21157-27817] -->
<h3 class="sectionedit8" id="создание_pcb-файлов_из_принципиальных_схем">Создание pcb-файлов из принципиальных схем</h3>
<div class="level3">

<p>
Прежде чем мы сможем продолжить, в <em><code>one.sch</code></em> нужно кое-что исправить.
Запустите <strong><code>gschem one.sch</code></strong> и обратите внимание, что программа
<strong>refdes_renum</strong> установила для наших операционных усилителей значения
<code>refdes</code> в <em>U101</em> и <em>U102</em>, не подумав, да и откуда она знает, что на
самом деле мы хотим использовать два операционных усилителя в одном корпусе
<em>TL072</em>. Для того-то мы и редактировали атрибут <code>slot</code> второго
операционного усилителя. Нам нужно вернуться и исправить атрибут <code>refdes</code>
второго усилителя на <em>U101</em>, чтобы у обоих усилителей он был одинаков и на
нашей печатной плате был только один корпус <em>TL072</em>.
</p>

<p>
Теперь, когда файл <em><code>project</code></em> для <strong>gsch2pcb</strong> уже настроен, всё что
нам надо сделать для создания исходного набора pcb-файлов, это запустить
<strong>gsch2pcb</strong>:
</p>
<pre class="code">~/gaf/myproject1$ gsch2pcb project
0 file elements and 7 m4 elements added to board.pcb.</pre>

<p>
Сообщение гласит: «0 файловых элементов и 7 m4-элементов добавлено к board.pcb».
Так как в файле проекта <code>output-name</code> установлено в <em>board</em>, то создаваемые pcb-файлы называются <em><code>board.pcb</code></em> и <em><code>board.net</code></em>.
</p>

<p>
Внимание: более современный совет — сначала создать пустую плату в
<strong>pcb</strong>, а затем при каждом запуске <strong>gsch2pcb</strong> в топологии будут
производиться изменения, как описано ниже (в разделе <a href="#изменение_схем" title=":geda:gsch2pcb_tutorial.ru.txt ↵" class="wikilink1">Изменение схем</a>).
Смысл в том, что в настоящее время установки по умолчанию для <strong>gsch2pcb</strong>
совершенно отличаются от таковых для <strong>pcb</strong>, и по общему мнению для
большинства случаев умолчания <strong>pcb</strong> лучше.  Но есть одно «но»: если вы с
помощью <strong>pcb2panel</strong> компонуете из нескольких топологических схем одну на
одной плате, то если платы создавались с винегретом из умолчаний
<strong>gsch2pcb</strong> и (современной) программы <strong>pcb</strong> без редактирования стека
слоёв, которое может требовать дополнительной работы, вы получите
непригодные результаты. (mjm, Aug 2008)
</p>

<p>
Если <strong>gsch2pcb</strong> говорит вам что-то вроде: <em>2 unknown elements added to
board.pcb.</em> (2 неизвестных элемента добавлено к board.pcb), запустите
программу с флагом <code>-v</code>: <strong><code>gsch2pcb -v project</code></strong> и вывод <strong>gsch2pcb</strong>
подскажет вам, какие компоненты в схеме не имеют известного <code>footprint</code>.
Либо вы забыли добавить данный атрибут, либо его значение неправильно, либо
pcb-элемент для него отсутствует в установленных библиотеках.  Но если
<strong>gsch2pcb</strong> вообще не может найти ни одного элемента и все 7 неизвестны,
то, вероятно, <strong>gsch2pcb</strong> не может найти каталог установки ваших
<em>m4-элементов</em> для <strong>pcb</strong>. В таком случае посмотрите первую часть раздела
<a href="#нестандартные_m4-элементы" title=":geda:gsch2pcb_tutorial.ru.txt ↵" class="wikilink1">Нестандартные m4-элементы</a>.
</p>

</div>
<!-- EDIT8 SECTION "Создание pcb-файлов из принципиальных схем" [27818-32050] -->
<h3 class="sectionedit9" id="разработка_топологии_в_pcb-файлах">Разработка топологии в pcb-файлах</h3>
<div class="level3">

</div>

<h4 id="установка_умолчаний">Установка умолчаний</h4>
<div class="level4">

<p>
<a href="media/geda/board-1.png" class="media" target="_blank" title="geda:board-1.png"><img src="media/geda/board-1.png" class="medialeft" title="pcb, шаг 1" alt="pcb, шаг 1" /></a>Запустите <strong><code>pcb board.pcb</code></strong>.  Вы увидите
большую кучу pcb-элементов, заданных в атрибутах <code>footprint</code> компонентов
схемы. Это нормально, позже мы приведём всё это в порядок.
</p>

<p>
Когда вы открываете pcb-файл в <strong>pcb</strong> первый раз, нужно настроить разные
исходные значения.  Обычно для большей части работы по разводке я сначала
устанавливаю шаг сетки в 25 милов из меню <strong><em>Вид</em></strong> → <strong><em>Шаг сетки</em></strong>
→ <strong><em>25 милов</em></strong>, а затем, если где-нибудь понадобится более плотная
компоновка, изменяю его на меньшие значения.  Обратите внимание, что если
единицами измерения сделать миллиметры с помощью <strong><em>Вид</em></strong> → <strong><em>Единицы
измерения сетки</em></strong> → <strong><em>мм</em></strong>, то вместо милов в меню <strong><em>Вид</em></strong> →
<strong><em>Шаг сетки</em></strong> будет ряд вариантов размеров в миллиметрах. Между
миллиметрами и милами можно переключаться в любое время.
</p>

<p>
Ещё нужно задать умолчания для размеров линий и отверстий в
<a href="geda-glossary.ru.html#стиль_трассировки" class="wikilink1" title="geda-glossary.ru.html">стилях разводки</a> <strong>Сигналы</strong>,
<strong>Питание</strong>, <strong>Толстый</strong> и <strong>Тонкий</strong>. Чтобы задать эти размеры, надо просто
выбрать один из этих стилей в нижнем левом углу окна <strong>pcb</strong> и нажать кнопку
<strong>Стиль трассировки</strong>. Размер своей платы можно установить сейчас, а можно
отложить на потом, занявшись работой над топологией. Чтобы изменить размер
платы, откройте окно <strong><em>Файл</em></strong> → <strong><em>Настройки…</em></strong> и выберите
страницу <strong>Размеры</strong>. В этом окне можно поменять и другие значения,
например, приращения и значения для <a href="geda-glossary.ru.html#проверка_соответствия_проектным_нормам" class="wikilink1" title="geda-glossary.ru.html">проверки на соответствие проектным нормам</a>.  Чтобы узнать,
что это такое, вам следует просмотреть документацию по <strong>pcb</strong>.  И может
быть вам покажется полезной установка <strong><em>Вид</em></strong> → <strong><em>Отображать
сетку</em></strong>.
</p>

</div>

<h4 id="распределение_компонентов">Распределение компонентов</h4>
<div class="level4">

<p>
<a href="media/geda/board-2.png" class="media" target="_blank" title="geda:board-2.png"><img src="media/geda/board-2.png" class="mediaright" title="Шаг 2" alt="Шаг 2" /></a> Берите элементы средней кнопкой мыши и
расставляйте по одному, пока их все не разнесёте.
</p>

<p>
Можно и самой программе <strong>pcb</strong> позволить разнести элементы с помощью
<strong><em>Выделение</em></strong> → <strong><em>Распределить все элементы</em></strong>, а потом уже вручную
подкорректировать их положение.
</p>

</div>

<h4 id="загрузка_списка_соединений">Загрузка списка соединений</h4>
<div class="level4">

<p>
<a href="media/geda/board-3.png" class="media" target="_blank" title="geda:board-3.png"><img src="media/geda/board-3.png" class="medialeft" title="Шаг 3" alt="Шаг 3" /></a>
</p>
<ul>
<li class="level1"><div class="li"> Откройте <strong><em>Файл</em></strong> → <strong><em>Загрузить список соединений</em></strong> и выберите <em><code>board.net</code></em></div>
</li>
<li class="level1"><div class="li"> Запустите <strong><em>Соединения</em></strong> → <strong><em>Оптимизировать линии связи</em></strong>. Теперь выводы и контактные площадки компонентов должны соединяться прямыми линиями — <a href="geda-glossary.ru.html#линии_связи" class="wikilink1" title="geda-glossary.ru.html">линиями связи</a> — в соответствии со схемой.</div>
</li>
</ul>

<p>
Для уменьшения беспорядка <strong>pcb</strong> пытается начертить линии связи для сложных
соединений так, чтобы их суммарная длина была наименьшей. Попробуйте
перетащить элемент на другую сторону рабочей области. Линии связи будут
следовать за ним как резиновые, но их концы не будут перепрыгивать на другие
узлы, хотя при этом общая длина и могла бы стать меньше. Перепрыгнуть линии
связи, для получения «лучшей» геометрии, заставит
<a href="geda-glossary.ru.html#действие" class="wikilink1" title="geda-glossary.ru.html">действие</a> <strong><em>Оптимизировать линии связи</em></strong>. В любое
время его легко запустить, нажав клавишу <kbd>O</kbd>.
</p>

</div>

<h4 id="компоновка">Компоновка</h4>
<div class="level4">

<p>
<a href="media/geda/board-4.png" class="media" target="_blank" title="geda:board-4.png"><img src="media/geda/board-4.png" class="mediaright" title="Шаг 4" alt="Шаг 4" /></a>Теперь линии связи нужно заменить дорожками,
которые можно будет протравить на медной поверхности платы. Обычно после
<strong><em>Распределить все элементы</em></strong> линии связи расположены беспорядочно и
часто пересекаются. Попробуйте распутать как можно больше этих линий
перемещением и поворотом компонентов. Ключ к хорошо разведённой печатной
плате — правильное размещение компонентов. Хотя <strong>pcb</strong> и пытается
приводить линии связи в порядок, будет хорошо, если вы привыкнете при
размещении компонентов время от времени их оптимизировать, нажимая клавишу
<kbd>O</kbd>.
</p>

<p>
Выберите инструмент <strong>ROT</strong> (<kbd>F9</kbd>), позволяющий средней кнопкой
мыши перемещать элементы, а левой — поворачивать. Правой кнопкой при
увеличенном масштабе можно смещать область просмотра в пределах рабочей
области окна. Попробуйте увеличить и уменьшить масштаб колёсиком мыши или
клавишами <kbd>Z</kbd> и <kbd>Shift</kbd>+<kbd>Z</kbd>. Наведите курсор мыши на вывод и
нажмите клавишу <kbd>F</kbd>, чтобы подсветить объекты, касающиеся этого
вывода и получше рассмотреть дорожки.  Попробуйте убрать подсветку, нажав
<kbd>Shift</kbd>+<kbd>F</kbd>. В любое время изменения можно отменить, нажав
<kbd>U</kbd>.
</p>

<p>
Обратите внимание: вместо того, чтобы вручную размещать компоненты (или
разносить с помощью команд <strong><em>Выделение</em></strong> → <strong><em>Распределить …</em></strong>),
как описано выше, можно использовать возможность авторазмещения в
<strong>pcb</strong>. Для этого нужно загрузить список соединений, выбрать компоненты для
автоматического размещения (если это первый запуск <strong>pcb</strong>, просто
<strong><em>Выделение</em></strong> → <strong><em>Выделить все видимые объекты</em></strong>), затем выбрать
<strong><em>Выделение</em></strong> → <strong><em>Авторазмещение выделенных элементов</em></strong>. После
этого можно снова подкорректировать созданную программой расстановку
вручную. Функция авторазмещения должна расставить элементы более разумно,
чем функция распределения, но когда топология разрастается, она работает
намного медленнее.
</p>

</div>

<h4 id="замещение_линий_связи_дорожками">Замещение линий связи дорожками</h4>
<div class="level4">

<p>
<a href="media/geda/board-5.png" class="media" target="_blank" title="geda:board-5.png"><img src="media/geda/board-5.png" class="medialeft" title="Шаг 5" alt="Шаг 5" /></a> Теперь можно начать
<a href="geda-glossary.ru.html#трассировка" class="wikilink1" title="geda-glossary.ru.html">трассировку</a> — разводку дорожек между
выводами, соединёнными линиями связи. На левой панели инструментов <strong>pcb</strong>
выберите инструмент <strong>LINE</strong>, выберите слой, на котором хотите чертить
(<strong>solder</strong> – слой пайки, <strong>component</strong> – слой компонентов, и т. д.), и
начните чертить линии, выбирая конечные точки левой кнопкой мыши.  Отметим
ещё раз, клавиша <kbd>F</kbd> поможет вам найти дорожки, которые нужно
соединить. Если вы хотите остановить текущую дорожку, чтобы начать чертить
новую где-то в другом месте, закончите её щелчком средней кнопки мыши.
Можно поиграться здесь и с автотрассировкой.
</p>

<p>
Очень полезное действие инструмента <strong>SEL</strong> — выделение нескольких
объектов с последующим вырезанием или копированием их в буфер обмена из меню
<strong><em>Правка</em></strong> → <strong><em>Вырезать выделение в буфер</em></strong> (или <strong><em>Правка</em></strong> →
<strong><em>Копировать выделение в буфер</em></strong>). Содержимое буфера можно тотчас же
вставить или отменить текущую вставку выбором другого
инструмента. Содержимое буфера можно вставить потом в любое время из меню
<strong><em>Буфер</em></strong> → <strong><em>Вставить из буфера</em></strong>. Таким образом можно перемещать
области топологии или переходить в другое место и повторять общие шаблоны
дорожек. Чтобы выбрать несколько объектов инструментом <strong>SEL</strong>, надо нажав
кнопку мыши выделить нужную область, потом нажав <kbd>Shift</kbd> и щёлкая
мышью можно добавлять объекты к уже выделенным.
</p>

<p>
Когда разводка дорожек закончена (если при очередной оптимизации линий связи
все дорожки разведены, <strong>pcb</strong> вас поздравит с этим), плата может выглядеть
примерно так, как показано здесь. Для такого вида я выбрал <strong><em>Вид</em></strong> →
<strong><em>Отображаемое название элемента</em></strong> → <strong><em>Значение</em></strong>).
</p>

<p>
Вам, вероятно, хочется иметь больше информации по использованию <strong>pcb</strong> и в
tar-архиве исходных текстов <strong>pcb</strong> есть комплект документации в формате
<abbr title="HyperText Markup Language">HTML</abbr>. Я не знаю, на что здесь сослаться, но со страницы
<a href="http://sourceforge.net/projects/pcb/" class="urlextern" title="http://sourceforge.net/projects/pcb/" rel="nofollow">Разработка pcb</a> можно скачать
последний tar-архив. Файлы документации могут быть установлены где-то и в
вашей системе. В Debian они устанавливаются из пакета в
<em><code>/usr/share/doc/pcb/html/</code></em>. В <strong>pcb</strong> есть ещё и удобная «активная»
документация, с помощью которой можно познакомиться с назначением клавиш или
вводимыми с клавиатуры командами. Откройте меню <strong><em>Информация</em></strong> →
<strong><em>Назначение клавиш</em></strong> и вы, вероятно, обнаружите, что просто читая об
имеющихся привязках клавиш можно научиться многому из того, что можно делать
в <strong>pcb</strong>.  Если в окне <strong><em>Файл</em></strong> → <strong><em>Настройки…</em></strong> вы выбрали
<em>Использовать отдельное окно для ввода команд</em>, то затем, когда откроете
окно команд через <strong><em>Окно</em></strong> → <strong><em>Ввод команды</em></strong> (или клавишей
<kbd>:</kbd>), вы увидите стрелку и надпись <strong>Справка по
командам</strong>. Щёлкните на стрелку и откроется справка по некоторым командам,
которые здесь можно набрать и для которых могут отсутствовать пункты меню
или привязки клавиш.
</p>

<p>
Скажем, например, вы задали на странице <strong><em>Настройки…</em></strong> →
<strong><em>Приращения</em></strong> размер приращений равный 5 милов. С такой настройкой
можно выбрать несколько линий и затем увеличить их ширину на 5 милов из меню
<strong><em>Выделение</em></strong> → <strong><em>Изменить размер выделенных объектов</em></strong> →
<strong><em>Линии +5 милов</em></strong>. Но предположим, значения ширины хочется менять
произвольно, а каждый раз <strong>Настройки…</strong> менять неудобно. Тогда можно
выбрать несколько линий, открыть окно команды (нажатием <kbd>:</kbd>) и
ввести команду:
</p>
<pre class="code">changesize(selectedlines, +3, mils)</pre>

<p>
и выбранные линии увеличатся на 3 мила. Эта команда теперь в списке истории, её можно вызвать повторно и быстро отредактировать в окне команды, подставив нужные значения размеров.
</p>

</div>

<h4 id="посмотрим_на_другую_сторону_платы">Посмотрим на другую сторону платы</h4>
<div class="level4">

<p>
Для некоторых разработок важно располагать компоненты на обеих сторонах
платы, хотя в предшествующем примере это нам и не нужно. В таких случаях
клавишей <kbd>Tab</kbd> плату можно перевернуть сверху вниз и посмотреть на
неё сзади, в то время как клавишей <kbd>B</kbd> выделенный компонент можно
переместить на противоположную сторону платы.  Для двухсторонних плат также
важно учитывать, на какой стороне находится конкретный слой дорожек. Это
можно посмотреть и настроить в диалоговом окне <strong><em>Файл</em></strong> →
<strong><em>Настройки…</em></strong> → <strong><em>Слои</em></strong> → <strong><em>Группы</em></strong>. Слои стороны
<strong>component</strong> будут находиться наверху платы, слои стороны <strong>solder</strong> —
внизу. В этом окне нужно обеспечить, чтобы все слои, которые будут
производиться за один шаг (т. е. протравливаться фотолитографическим
методом), были сгруппированы вместе.
</p>

</div>
<!-- EDIT9 SECTION "Разработка топологии в pcb-файлах" [32051-48489] -->
<h2 class="sectionedit10" id="изменение_схем">Изменение схем</h2>
<div class="level2">

<p>
Процесс переноса изменений принципиальной схемы в топологию <strong>pcb</strong> с
помощью <strong>gsch2pcb</strong> очень прост. После того как с помощью <strong>gsch2pcb</strong>
создан исходный файл <em><code>board.pcb</code></em>, всякий раз, когда в схемы вносятся
изменения в <strong>gschem</strong>, нужно запускать <strong><code>gsch2pcb project</code></strong>. Затем надо
будет запустить <strong><code>pcb board.pcb</code></strong> и выполнить необходимые шаги в
зависимости от действий программы <strong>gsch2pcb</strong>. Каждый раз при запуске
<strong>gsch2pcb</strong> происходит следующее:
</p>
<ul>
<li class="level1"><div class="li"> <strong>gsch2pcb</strong> всегда создаёт новый список соединений <em><code>board.net</code></em>. Если соединения изменились, загрузите этот файл после запуска <strong>pcb</strong>.</div>
</li>
<li class="level1"><div class="li"> Если вы добавили в схему компоненты (с атрибутами <code>footprint</code>), <strong>gsch2pcb</strong> создаст файл <em><code>board.new.pcb</code></em>, содержащий все новые pcb-элементы, соответствующие этим атрибутам. Затем запустите <strong><code>pcb board.pcb</code></strong> и загрузите <em><code>board.new.pcb</code></em> с новыми элементами в существующую топологию с помощью <strong><em>Файл</em></strong> → <strong><em>Загрузить топологию в буфер обмена</em></strong>. Разместите новые элементы, загрузите новый список соединений и проведите новые дорожки.</div>
</li>
<li class="level1"><div class="li"> Если вы удалили компоненты из схемы, <strong>gsch2pcb</strong> удалит соответствующие pcb-элементы из <em><code>board.pcb</code></em>. Вам нужно только запустить <strong><code>pcb board.pcb</code></strong> и убрать висящие дорожки, оставшиеся от удалённых элементов.</div>
</li>
<li class="level1"><div class="li"> Если вы изменили атрибут <code>footprint</code> существующего компонента, <strong>gsch2pcb</strong> удалит соответствующий ему старый элемент из <em><code>board.pcb</code></em> и добавит новый элемент к <em><code>board.new.pcb</code></em>.</div>
</li>
<li class="level1"><div class="li"> Если вы изменили атрибуты <code>value</code> компонентов схемы, изменённые значения будут внесены непосредственно в файл <em><code>board.pcb</code></em>.</div>
</li>
</ul>

<p>
Итак, при использовании <strong>gsch2pcb</strong> все изменения pcb-элементов приводятся
в действие изменениями в принципиальных схемах и элементы для компонентов
никогда не нужно добавлять или удалять вручную.
</p>

<p>
Однако pcb-элементы, не являющиеся частью схем, такие как отверстия для
крепежа печатной платы, всё же придётся добавлять вручную. При этом надо
обеспечить, чтобы таким, добавленным вручную, pcb-элементам никогда не
задавалось <code>Название на плате</code>, так как оно зарезервировано для значений
атрибутов <code>refdes</code> компонентов принципиальной схемы и <strong>gsch2pcb</strong> захочет
удалить элементы с непустым <code>Названием на плате</code>, не соответствующие ни
одному из значений <code>refdes</code> компонентов схемы.
</p>

<p>
До сих пор для нашей платы мы использовали только <em>m4-элементы</em>, теперь
давайте изменим схему и попробуем работать с <em>файловыми элементами</em>. Но
сначала хорошо бы познакомиться с элементами, предлагаемыми в <strong>pcb</strong> по
умолчанию.  В зависимости от места установки вашей <strong>pcb</strong> у вас будет
каталог <em><code>/usr/local/share/pcb/newlib</code></em>, <em><code>/usr/share/pcb/newlib</code></em>
или возможно какой-то ещё (это зависит от <em>префикса</em>, указанного при
установке <strong>pcb</strong>). В версиях <strong>pcb</strong> до <strong>20031113</strong> вместо библиотеки
<strong>newlib</strong> использовалась <strong>pcb_lib</strong>, путь доступа к которой
<em><code>/usr/local/pcb_lib</code></em> или <em><code>/usr/lib/pcb_lib</code></em>.  Когда вы найдёте у
себя каталог <em><code>newlib</code></em>, взгляните на имена файлов в его
подкаталогах. Каждое из этих имён может использоваться как значение атрибута
<code>footprint</code> для компонентов в принципиальной схеме.  Например, имеется
файл <em><code>xxx/newlib/2_pin_thru-hole_packages/0.125W_Carbon_Resistor</code></em>, так
что если бы мы на своей плате захотели использовать 0,125-ваттные резисторы,
атрибут <code>footprint</code> резистора можно было бы установить в
<em>0.125W_Carbon_Resistor</em> вместо <em>R025</em>.  Попробуйте изменить, скажем,
резистор <em>R101</em> в <em><code>one.sch</code></em>, задав для него
<em>0.125W_Carbon_Resistor</em>, а затем запустите <strong><code>gsch2pcb project</code></strong>.
Если <strong>gsch2pcb</strong> не находит такого элемента, значит в свой файл
<em><code>project</code></em> вам нужно добавить путь доступа к каталогу <em><code>newlib</code></em>
примерно такой строкой:
</p>
<pre class="code">elements-dir /usr/lib/newlib</pre>

<p>
Если <strong>gsch2pcb</strong> найдёт его, вы получите:
</p>
<pre class="code">~/gaf/myproject1$ gsch2pcb project
board.pcb is backed up as board.pcb.bak1.
1 elements deleted from board.pcb.
1 file elements and 0 m4 elements added to board.new.pcb.</pre>

<p>
Теперь нужно запустить <strong><code>pcb board.pcb</code></strong>. Вы увидите, что элемент для резистора <em>R101</em> пропал<sup><a href="#fn__5" id="fnt__5" class="fn_top">5)</a></sup> и при загрузке <em><code>board.new.pcb</code></em> из меню <strong><em>Файл</em></strong> → <strong><em>Загрузить топологию в буфер обмена</em></strong> появится новый элемент.
</p>

</div>
<!-- EDIT10 SECTION "Изменение схем" [48490-55497] -->
<h2 class="sectionedit11" id="нестандартные_символы_для_gschem">Нестандартные символы для gschem</h2>
<div class="level2">

<p>
Обычным способом создания своих нестандартных символов является изменение
существующих. Что мне не нравится в используемом нами
<em><code>dual-opamp-1.sym</code></em>, так это то, что выводы питания повторяются на
каждом символе. Хотя кому-то может это и нравится, мне кажется, что при этом
страница, полная операционных усилителей, выглядит слегка хаотично. Это
предоставляет нам неплохую возможность изучить атрибуты <code>net</code> в данном
руководстве. К символам в <strong>gschem</strong> можно прикреплять атрибуты <code>net</code>,
которые привязывают выводы к конкретным соединениям. Вместо подключения
выводов <em>8</em> каждого операционного усилителя к <em><code>Vcc</code></em>, а выводов <em>4</em>
к <em><code>Vee</code></em> в схеме, можно сделать так, что это будет производиться
автоматически, и эти выводы из схемы убрать. Для этого просто скопируйте
файл исходного символа в каталог своих символов для <strong>gschem</strong>, задав ему
новое имя, и отредактируйте его. Выполните шаги, описанные ниже. (Каталог
установки символов gEDA может быть у вас другим, например,
<em><code>/usr/local/share/gEDA/sym/</code></em>):
</p>

</div>

<h5 id="установка_видимости_атрибутов">Установка видимости атрибутов</h5>
<div class="level5">

<p>
<a href="media/geda/gschem-sym-1.png" class="media" target="_blank" title="geda:gschem-sym-1.png"><img src="media/geda/gschem-sym-1.png" class="medialeft" title="Шаг 1" alt="Шаг 1" /></a>
</p>
<pre class="code">cd /usr/share/gEDA/sym/analog/
cp dual-opamp-1.sym ~/gaf/gschem-sym/opamp-dual.sym
cd ~/gaf/gschem-sym
gschem opamp-dual.sym</pre>
<ul>
<li class="level1"><div class="li"> Нажмите клавиши <kbd>E</kbd><kbd>N</kbd>, чтобы атрибуты было видно.</div>
</li>
<li class="level1"><div class="li"> Нажмите клавиши <kbd>V</kbd><kbd>E</kbd>, чтобы увидеть всю схему целиком.</div>
</li>
<li class="level1"><div class="li"> Выделите вывод <em>8</em> щелчком левой кнопки мыши по нему.</div>
</li>
</ul>

</div>

<h5 id="удаление_видимых_выводов_питания">Удаление видимых выводов питания</h5>
<div class="level5">

<p>
<a href="media/geda/gschem-sym-2.png" class="media" target="_blank" title="geda:gschem-sym-2.png"><img src="media/geda/gschem-sym-2.png" class="medialeft" title="Шаг 2" alt="Шаг 2" /></a>
</p>
<ul>
<li class="level1"><div class="li"> Удалите вывод <em>8</em> нажатием клавиши <kbd>Delete</kbd>.</div>
</li>
<li class="level1"><div class="li"> Подобным образом выделите и удалите вывод <em>4</em>.</div>
</li>
<li class="level1"><div class="li"> Дважды щелкните по строкам <code>slotdef</code>, чтобы выбрать и изменить их. Удалите из них выводы <em>4</em> и <em>8</em>.</div>
</li>
</ul>

</div>

<h5 id="добавление_глобальных_соединений_в_числовом_виде">Добавление глобальных соединений в числовом виде</h5>
<div class="level5">

<p>
<a href="media/geda/gschem-sym-3.png" class="media" target="_blank" title="geda:gschem-sym-3.png"><img src="media/geda/gschem-sym-3.png" class="medialeft" title="Шаг 3" alt="Шаг 3" /></a>Из меню <strong><em>Добавить</em></strong> → <strong><em>Атрибут…</em></strong>:
</p>
<ul>
<li class="level1"><div class="li"> Добавьте атрибут <code>net</code> со значением <em>Vcc:8</em>. Выберите <strong>Показать имя и значение</strong> и сделайте его невидимым.</div>
</li>
<li class="level1"><div class="li"> Добавьте атрибут <code>net</code> со значением <em>Vee:4</em>. Установите <strong>Показать имя и значение</strong> и сделайте его невидимым.</div>
</li>
<li class="level1"><div class="li"> Атрибут <code>device</code> установите просто в <em>OPAMP</em>.</div>
</li>
</ul>

<p>
Упорядочьте новые атрибуты, как показано на рисунке.
</p>

<p>
Если хотите, можете изменить значение атрибута <code>footprint</code>, которое будет
устанавливаться по умолчанию. При редактировании символов очень важно после
внесения всех изменений выполнять <strong><em>Правка</em></strong> → <strong><em>Смещение
символа…</em></strong>, устанавливая смещение в ноль перед сохранением. Сделайте это
и сохраните символ из меню <strong><em>Файл</em></strong> → <strong><em>Сохранить</em></strong>. Я установил
значение атрибута <code>footprint</code> по умолчанию в <em>DIP8</em>, так как это мой
собственный элемент.
</p>

</div>

<h5 id="запуск_gschem_с_новым_символом">Запуск gschem с новым символом</h5>
<div class="level5">

<p>
<a href="media/geda/one-sch-3.png" class="media" target="_blank" title="geda:one-sch-3.png"><img src="media/geda/one-sch-3.png" class="medialeft" title="one.sch" alt="one.sch" /></a> Запустите <strong><code>gschem one.sch</code></strong>. Выделите и
удалите клавишей <kbd>Delete</kbd> оба операционных усилителя. Удалите также
подключенные к ним символы <em><code>Vcc</code></em> и <em><code>Vee</code></em>. Откройте окно
<strong><em>Добавить</em></strong> → <strong><em>Компонент…</em></strong> и из библиотеки <em><code>gschem-sym</code></em>,
которая теперь должна содержать ваш новый символ, выберите и поместите на
схему два символа <em><code>opamp-dual.sym</code></em>. Переместите их в подходящее место
на схеме и не забудьте зеркально отразить и повернуть нижний операционный
усилитель как и прежде. Измените атрибуты каждого из операционных
усилителей, задав им те же значения, которые они имели раньше,
т. е. установите <code>footprint</code> в <em>DIL 8 300</em>, добавьте атрибут <code>value</code>
со значением <em>TL072</em> и установите <code>refdes</code> для обоих усилителей в
<em>U101</em>. Установите <code>slot</code> для второго операционного усилителя в
<em>2</em>. Если не установить значения атрибутов в те, что были раньше,
<strong>gsch2pcb</strong> подумает, что это другой компонент и удалит существующий корпус
<em>DIL</em> с топологической схемы. Если всё сделано верно, запуск <strong>gsch2pcb</strong>
должен показать:
</p>
<pre class="code">~/gaf/myproject1$ gsch2pcb project
Found a cpinlist head with a netname! [Vcc]
Found a cpinlist head with a netname! [Vee]
Found a cpinlist head with a netname! [Vcc]
Found a cpinlist head with a netname! [Vee]
Found a cpinlist head with a netname! [Vcc]
Found a cpinlist head with a netname! [Vee]
Found a cpinlist head with a netname! [Vcc]
Found a cpinlist head with a netname! [Vee]
No elements to add so not creating board.new.pcb</pre>

<p>
откуда видно, что программа gEDA <strong>gnetlist</strong> кажется немножко «разволновалась», обнаружив добавленные нами только что новые атрибуты <em>Vcc</em> и <em>Vee</em><sup><a href="#fn__6" id="fnt__6" class="fn_top">6)</a></sup>, и создала новый список соединений. Теперь, я думаю, схема выглядит опрятнее. И если вы запустите <strong><code>pcb board.pcb</code></strong>, загрузите новый список соединений, а затем оптимизируете линии связи, программа <strong>pcb</strong> должна будет сообщить вам, что плата готова, а это значит, что соединение выводов питания операционных усилителей через атрибут <code>net</code> сработало.
</p>

<p>
Подробное описание создания символов вы можете найти в
<a href="geda-gschem_symbol_creation.ru.html" class="wikilink1" title="geda-gschem_symbol_creation.ru.html">Руководстве по созданию символов</a> на
странице <a href="geda-documentation.ru.html" class="wikilink1" title="geda-documentation.ru.html">Документации gEDA</a>.
</p>

</div>
<!-- EDIT11 SECTION "Нестандартные символы для gschem" [55498-63623] -->
<h2 class="sectionedit12" id="нестандартные_файловые_элементы">Нестандартные файловые элементы</h2>
<div class="level2">

<p>
Свои оригинальные <em>файловые элементы</em> можно создавать либо в процессе
работы в <strong>pcb</strong> над какой-то топологической схемой, либо просто запуская
<strong>pcb</strong> для создания элемента. Для демонстрации сделаем нестандартный
элемент для диода <em>1N4004</em>. <strong>pcb</strong> предоставляет в наше распоряжение
<a href="geda-glossary.ru.html#аксиальный_компонент" class="wikilink1" title="geda-glossary.ru.html">аксиальные</a> корпуса, но мы хотим
быть уверены, что для сверления отверстий под слегка утолщённые выводы этого
1-амперного диода будет использоваться подходящий размер сверла.  Для них
нужно сверло диаметром примерно 42 мила (#58).
</p>

<p>
Запустите <strong>pcb</strong> и первое, что надо сделать, это выбрать стиль разводки
<strong>Сигналы</strong> и изменить для него размеры (нажмите кнопку <strong>Стиль трассировки</strong>).
Установите <strong>Отверстие перехода</strong> в <em>42</em>, а <strong>Размер перехода</strong> в <em>70</em>
или, если хотите, больше.
Выберите
<strong><em>Вид</em></strong> → <strong><em>Шаг сетки</em></strong> → <strong><em>25 милов</em></strong> и
<strong><em>Вид</em></strong> → <strong><em>Отображать сетку</em></strong>.
Несколько увеличьте масштаб, а затем начертите элемент:
<a href="media/geda/pcb-el-1.png" class="media" target="_blank" title="geda:pcb-el-1.png"><img src="media/geda/pcb-el-1.png" class="medialeft" title="Шаг 1" alt="Шаг 1" /></a>
</p>
<ul>
<li class="level1"><div class="li"> Выберите инструмент <strong>VIA</strong> и поместите два перехода на 400 милов друг от друга.</div>
</li>
<li class="level1"><div class="li"> Наведите курсор мыши на левый переход, нажмите клавишу <kbd>N</kbd> и задайте переходу название <em>1</em>. Задайте правому переходу название <em>2</em>.</div>
</li>
<li class="level1"><div class="li"> Вывод <em>1</em> будет катодом и это должно соответствовать номерам выводов в вашем символе диода для <strong>gschem</strong>.</div>
</li>
</ul>

<p>
<a href="media/geda/pcb-el-2.png" class="media" target="_blank" title="geda:pcb-el-2.png"><img src="media/geda/pcb-el-2.png" class="mediaright" title="Шаг 2" alt="Шаг 2" /></a>
</p>
<ul>
<li class="level1"><div class="li"> Выберите слой <strong>Шелкография</strong> и инструмент <strong>LINE</strong>.</div>
</li>
<li class="level1"><div class="li"> Начертите контур компонента как показано, с шириной линии и шагом сетки, установленными в 10 милов.</div>
</li>
<li class="level1"><div class="li"> Установив ширину линии в 20 милов, начертите тремя линиями маркировку катода с левой стороны.</div>
</li>
<li class="level1"><div class="li"> Не перекрывайте площадки пайки линиями слоя шелкографии.</div>
</li>
</ul>

<p>
Выделите переходы и только что начерченный контур
с помощью инструмента <strong>SEL</strong> и закончите создание элемента:
</p>
<ul>
<li class="level1"><div class="li"> <strong><em>Буфер</em></strong> → <strong><em>Вырезать выделение в буфер</em></strong>, подведите курсор мыши к центру левого перехода и щёлкните.</div>
</li>
<li class="level1"><div class="li"> <strong><em>Буфер</em></strong> → <strong><em>Преобразовать буфер в элемент</em></strong></div>
</li>
<li class="level1"><div class="li"> <strong><em>Буфер</em></strong> → <strong><em>Сохранить элементы из буфера в файл</em></strong>, укажите <em><code>~/gaf/pcb-elements</code></em> и сохраните элемент как <em><code>D400-1A</code></em>, так как это корпус для 1-амперного диода с расстоянием между выводами 400 милов. Можете задать ему любое описательное название по вкусу.</div>
</li>
</ul>

<p>
<strong>Примечание:</strong> если при сохранении элемента указать название уже
существующего <em>m4-элемента</em>, и если не задать программе <strong>gsch2pcb</strong> ключ
<code>--use-files</code> (или <code>-f</code>), то она предпочтёт использовать <em>m4-элемент</em>.
Если вы хотите, чтобы предпочтение всегда отдавалось <em>файловым элементам</em>,
<code>use-files</code> можно поместить в файл проекта. Названия <em>m4-элементов</em>,
кажется, задаются в верхнем регистре, так что можно было бы избежать данных
проблем, используя для названий своих <em>файловых элементов</em> нижний регистр.
Также мне известен лишь один единственный способ сделать изображение вывода 1
квадратным – вручную отредактировать файл <em><code>D400-1A</code></em> и изменить флаг
квадратности в строке для первого вывода (<code>Pin ... &quot;1&quot; ...</code>). Например, измените строку:
</p>
<pre class="code">Pin(0 0 70 20 70 42 &quot;&quot; &quot;1&quot; 0x00000001)</pre>

<p>
на
</p>
<pre class="code">Pin(0 0 70 20 70 42 &quot;&quot; &quot;1&quot; 0x00000101)</pre>

<p>
Теперь <em>D400-1A</em> можно использовать в атрибуте <code>footprint</code> символа
<strong>gschem</strong> и <strong>gsch2pcb</strong> найдёт его при условии, что вы сделали ссылку
<em><code>packages</code></em>, описанную в разделе <a href="#настройка" title=":geda:gsch2pcb_tutorial.ru.txt ↵" class="wikilink1">Настройка</a>. Если вы не сделали такую
ссылку, программе <strong>gsch2pcb</strong> всё же можно сообщить имя каталога элементов
следующей строкой в файле проекта:
</p>
<pre class="code">elements-dir ~/gaf/pcb-elements</pre>

<p>
Быть может вы уже и заметили, но всё же скажу вам, что кое-что в моём примере
<em><code>myproject1</code></em> неправильно. Во-первых, линии слоя шелкографии в некоторых
элементах перекрывают площадки пайки, а во-вторых, транзистор расположен задом
наперёд на топологической схеме! В других случаях у вас не должно было бы быть
подобных проблем при работе в <strong>gschem</strong> и <strong>pcb</strong>, но иногда нумерация
выводов транзистора может сбить с толку. Если в своих разработках вы будете
использовать транзисторы, посмотрите описание
моего подхода, как обеспечить, чтобы нумерация
выводов символа транзистора для <strong>gschem</strong> была
скоординирована с номерами выводов pcb-элемента:
<a href="geda-transistor_guide.ru.html" class="wikilink1" title="geda-transistor_guide.ru.html">Руководство по транзистору.</a>
</p>

<p>
Из руководства по транзистору можно увидеть, что проблема здесь в том, что
элемент <em>TO92</em> использует менее распространённую конфигурацию нумерации
выводов <em>(3,2,1)</em>, в то время как <em><code>2N3904-1.sym</code></em> похож на символ
<em><code>npn-ebc</code></em>, выводы которого нумеруются в последовательности
<em>(1,2,3)</em>. В <strong>gschem</strong> номера выводов <em>2N3904</em> можно увидеть, нажав
клавиши <kbd>E</kbd><kbd>N</kbd> (и не смущайтесь атрибутом <code>pinseq</code>,
который почти закрывает <code>pinnumber</code>). А в <strong>pcb</strong> номера выводов <em>TO92</em>
можно увидеть наведя курсор мыши на элемент и нажав клавишу
<kbd>D</kbd>. Чтобы убедиться, что видны номера выводов, а не их названия,
выберите <strong><em>Вид</em></strong> → <strong><em>Отображать на цоколёвке номера</em></strong>.
</p>

<p>
У меня есть библиотеки с символами транзисторов и элементами, которые могут
показаться вам полезными, так что сначала для удобства можете наполнить свои
библиотеки файлами из моих <a href="media/geda/gsch2pcb-libs.tar.gz" class="media" target="_blank" title="geda:gsch2pcb-libs.tar.gz"> библиотек для
gschem/PCB</a>. Разархивируйте их в <em><code>~/gaf</code></em>, чтобы получить копию
настройки нашего примера, и там вы также найдёте файл
<em><code>~/gaf/pcb-elements.Readme</code></em>, документирующий
pcb-элементы. <em>Примечание: на момент 1.10.2004 г. я поправил pcb-элементы
tar-архива, чтобы они не перекрывали площадки пайки линиями слоя
шелкографии.</em> Если вы разархивируете их куда-то ещё, нужно будет
обеспечить, чтобы программы <strong>gschem</strong> и <strong>gsch2pcb</strong> могли их найти,
прописав для <strong>gschem</strong> строки <code>component-library</code> в <em><code>gafrc</code></em>, а для
<strong>gsch2pcb</strong> строки <code>elements-dir</code> в файл проекта.
</p>

<p>
Если вы установите эти библиотеки, то можете исправить <em>Q201</em> в
<em><code>two.sch</code></em>, заменив его посадочное место на <em>TO-92</em>, представляющее
собой мой нестандартный элемент с нумерацией выводов <em>(1,2,3)</em>. Затем
запустите <strong><code>gsch2pcb project</code></strong>, а затем <strong><code>pcb board.pcb</code></strong>, и
загрузите новый элемент для транзистора. На следующем рисунке схемы
<em><code>two.sch</code></em> атрибут <code>footprint</code> сделан видимым, чтобы подчеркнуть
вышесказанное, а также показан новый символ для <em>2N3904</em>, созданный из
моего <em><code>npn-ebc.sym</code></em>, как описано в моём руководстве по
транзистору. Если сравнить внешний вид контура этого транзистора на
обновлённой топологии <em><code>board.pcb</code></em> с тем, что было в исходном варианте,
можно увидеть, что ориентация теперь правильна и что линии слоя шелкографии
не перекрывают площадок пайки. Также, для иллюстрации другого стиля,
получающегося при использовании нестандартных элементов, я изменил атрибуты
<code>footprint</code> для резисторов <em>R102</em> и <em>R103</em> в <em><code>one.sch</code></em> на мои
собственные 0,125-ваттный элемент <em>R0w8</em> и 0,25-ваттный <em>R0w4</em>. Можно
увидеть также стиль <em>R101</em> после замены его посадочного места на
<em>0.125W_Carbon_Resistor</em>, как было предложено выше. Когда вы оцените
различия в стилях, я отмечу, что в своих элементах я хотел максимизировать
пространство, чтобы показывать тексты значений и позиционных обозначений
(тело 0,125-ваттного элемента могло бы быть и чуть побольше), и немного
увеличить диаметр площадок для пайки, чтобы он был менее критичен для
используемой техники производства плат. К тому же, для увеличения плотности
размещения компонентов расстояние между выводами моего резистора <em>R0w4</em>
сделано несколько меньшим, чем в <em>R025</em>.
</p>

<p>
<a href="media/geda/two-sch-2.png" class="media" target="_blank" title="geda:two-sch-2.png"><img src="media/geda/two-sch-2.png" class="medialeft" title="two.sch" alt="two.sch" /></a> <a href="media/geda/board-6.png" class="media" target="_blank" title="geda:board-6.png"><img src="media/geda/board-6.png" class="mediaright" title="pcb" alt="pcb" /></a>
</p>

</div>
<!-- EDIT12 SECTION "Нестандартные файловые элементы" [63624-76058] -->
<h2 class="sectionedit13" id="нестандартные_m4-элементы">Нестандартные m4-элементы</h2>
<div class="level2">

<p>
Сначала немного слов о том, как разыскать <em>m4-элементы</em>, имеющиеся в
поставке <strong>pcb</strong>. Полагаю, в проекте <strong>pcb</strong> есть какая-нибудь готовящаяся к
выпуску документация, но в данный момент я не знаю ничего, на что бы указать
вам, и тут нельзя просто сориентироваться по именам файлов, как это можно
было для <em>файловых элементов</em>. И ещё, ведь многие из этих элементов
требуют указания аргументов, и вам нужно определить, каких. Так что пока
всё, что я могу сказать вам, это то, что легче всего выяснить, что есть в
наличии, прочитав файлы <em>m4-элементов</em>, а для этого нужно знать место их
установки для <strong>pcb</strong>. Для версии <strong>pcb 20031113</strong> каталогом установки
наиболее вероятно будет <em><code>/usr/share/pcb/m4</code></em> или
<em><code>/usr/local/share/pcb/m4</code></em>, в то время как в более ранних версиях
<strong>pcb</strong> таковым мог быть <em><code>/usr/X11R6/lib/X11/pcb/m4</code></em> (чтобы увидеть,
какой из этих каталогов используется программой <strong>gsch2pcb</strong>, запустите
<strong><code>gsch2pcb --help</code></strong> или <strong><code>gsch2pcb -v project</code></strong>). Но если у вас
всё установлено где-то в другом месте, нужно выяснить где. Кстати, если
каталог <strong>m4</strong> <em>является другим</em>, нежели вышеуказанные три, тогда
<strong>gsch2pcb</strong> не найдёт ваши <em>m4-элементы</em> в вышеприведённых примерах, и
вам нужно будет добавить правильное имя каталога <strong>m4</strong> в свой файл
<em><code>project</code></em> строкой вида:
</p>
<pre class="code">m4-pcbdir /путь/к/pcb/m4</pre>

<p>
Просто прочитайте <em><code>.inc</code></em>-файлы в каталоге установки <strong>m4</strong>. Например, в
файле <em><code>misc.inc</code></em> вы найдёте использовавшийся нами элемент <em>R025</em>, и
его описание начинается так:
</p>
<pre class="code"># -------------------------------------------------------------------
# the definition of a resistor (0.25W) package
# $1: canonical name
# $2: name on PCB
# $3: value
define(`PKG_R025&#039;,
`Element(0x00 &quot;$1&quot; &quot;$2&quot; &quot;$3&quot; 120 30 0 100 0x00)
(
...</pre>

<p>
Отсюда можно узнать, что здесь определён макрос <strong>m4</strong> <code>PKG_</code> с названием
<em>R025</em>, принимающий 3 аргумента. Сейчас макросы всех <em>m4-элементов</em>
<strong>pcb</strong> принимают по меньшей мере три аргумента и программа <strong>gsch2pcb</strong>
автоматически берёт их из используемых в <strong>gschem</strong> атрибутов: <code>Каноническое
название</code> (<code>canonical name</code>) берётся из <code>footprint</code>, <code>название на плате</code>
(<code>name on PCB</code>) — из <code>refdes</code>, а <code>Значение</code> (<code>value</code>) — из
<code>value</code>.
<code>Каноническое название</code>, используемое в данных m4-файлах, это просто старый
способ обращения к используемому в современной <strong>pcb</strong> полю <code>Описание</code>
(<code>description</code>), как упомянуто выше в разделе <strong>Терминология</strong>.
Так как эти аргументы устанавливаются автоматически, никаких дополнительных
аргументов для <em>R025</em>, когда вы задаёте его как <code>footprint</code> в <strong>gschem</strong>, указывать не нужно.
Но теперь взгляните на определение следующего <em>m4-элемента</em> в <em><code>misc.inc</code></em>:
</p>
<pre class="code"># -------------------------------------------------------------------
# the definition of a SIL package without a common pin
# $1: canonical name
# $2: name on PCB
# $3: value
# $4: number of pins
define(`PKG_SIL&#039;,
`define(`MAXY&#039;, `eval(`$4&#039; * 100 -50)&#039;)
Element(0x00 &quot;$1&quot; &quot;$2&quot; &quot;$3&quot; 160 10 3 100 0x00)
(
...</pre>

<p>
Отсюда вы можете определить, что есть корпус <em>SIL</em>, который можно задавать
как <code>footprint</code>. Его макрос принимает 4 аргумента, но только первые три из
них обрабатываются автоматически, так что при его использовании нужно задать
ещё один.
На вас снисходит озарение, и вы ясно понимаете, что это корпус «Single
In Line» («односторонний»)! Так что может показаться, что вместо используемого
в нашем примере выше элемента <em>CONNECTOR 2 1</em>, определяющего 1 столбец,
нужно было бы использовать <em>SIL 2</em>. Но это ошибка! Потому что, прочитав тело
макроса, можно увидеть, что если аргумент равен <em>2</em>, второй цикл <strong>for</strong> не сможет его обработать. Фактически, он может работать только для аргументов
равных или больших <em>4</em>.  Если же вы всё же запустите <strong>gsch2pcb</strong>, и будет казаться, что программа застряла
в бесконечном цикле, причиной, скорее всего, является проблема с аргументами
макроса <strong>m4</strong>. Просмотрев <em><code>misc.inc</code></em>, вы в итоге определите, какие элементы из него можно использовать:
</p>
<pre class="code">Корпус      Аргументы, которые нужно задать
SD           1      количество выводов корпуса ZIP
MULTIWATT15  0
R025         0
SIL          1      количество выводов (мы знаем теперь, что должно быть &gt;= 4)
CSIL         1      количество выводов
QFP132       0
LED          1      диаметр светодиода (LED)
DIODE_LAY    1      расстояние между выводами
AXIAL_LAY    1      расстояние между выводами
CRYSTAL      1      ширина корпуса
OSC          0
ISA8         0
OVEN_OSC     0
RADIAL_CAN   1
SMD_BASE     2      длина и ширина устройства для поверхностного монтажа (SMD)
SMD_CHIP     1      длина корпуса</pre>

<p>
Ну и так далее для прочих файлов <em><code>.inc</code></em>…
</p>

<p>
Действительность такова, что настройка <strong>m4</strong> является менее дружественной
для пользователей (нельзя создавать элементы графическим способом) и более
сложной, чем простой подход, используемый для <em>файловых элементов</em> (нужно
понимать макросы <strong>m4</strong>). Поэтому я советую вам выполнять свои собственные
элементы главным образом в виде <em>файловых элементов</em>. С другой стороны
определение отдельных элементов с помощью принимающих аргументы макросов
даёт вам программируемые элементы, что может быть очень полезно при
разработке посадочных мест с большим количеством выводов.  Это особенно
хорошо для корпусов микросхем с изменяемыми шириной и количеством
выводов. Поэтому для хорошего примера использования нестандартного
<em>m4-элемента</em> можно предложить скопировать существующее макроопределение
корпусов микросхем (макрос <em>DIL</em>) в m4-файл, который <strong>gsch2pcb</strong> сможет
найти, и изменить его по своему вкусу. Местоположение результирующего
m4-файла может быть одним из следующих:
</p>
<ul>
<li class="level1"><div class="li"> <em><code>pcb.inc</code></em> в нашем каталоге <em><code>myproject1</code></em>, и сделанный нами элемент будет локальным для этого проекта.</div>
</li>
<li class="level1"><div class="li"> <em><code>~/.pcb/pcb.inc</code></em>, и элемент станет известен всем нашим проектам.</div>
</li>
<li class="level1"><div class="li"> <em><code>/путь/к/любому/файлу</code></em>, если этот путь известен <strong>gsch2pcb</strong>, для чего в файл проекта добавляется строка вида: <pre class="code">m4-file /путь/к/любому/файлу</pre>

<p>
 В зависимости от того, хотите ли вы, чтобы этот файл был известен только для данного проекта, для всех ваших проектов, или для всех проектов всех пользователей, эту строку можно добавить в один из следующих файлов:
</p>
<pre class="code">~/gaf/myproject1/project
~/.gsch2pcb
/usr/local/etc/gsch2pcb
/etc/gsch2pcb</pre>
</div>
</li>
</ul>

<p>
В настоящем руководстве я буду использовать первый способ (<em><code>pcb.inc</code></em>),
поэтому скопируйте существующий файл макроса:
</p>
<pre class="code">cd /usr/local/share/pcb/m4 (or /usr/share/pcb/m4 or /usr/X11R6/lib/X11/pcb/m4)
cp dil.inc ~/gaf/myproject1/pcb.inc
cd ~/gaf/myproject1</pre>

<p>
Теперь отредактируйте полученный файл <em><code>pcb.inc</code></em>, только что скопированный вами, и удалите из него всё, кроме макроса <code>PKG_DIL</code>. Измените название корпуса на что-то вроде <code>PKG_DILFAT</code>, потому что целью наших изменений будет увеличение выводов. На самом деле название можно было бы и не трогать и новое определение использовалось бы вместо старого, но пока продолжим с новым названием.  Измените диаметр выводов в строках <code>PIN</code> с <em>60</em> на <em>70</em>.  После этого целиком содержимое файла <em><code>pcb.inc</code></em> должно выглядеть так:
</p>
<pre class="code"># -------------------------------------------------------------------
# the definition of a dual-inline package N and similar types
# $1: canonical name
# $2: name on PCB
# $3: value
# $4: number of pins
# $5: package size (300, 600, 900 + 100 for socket space)
#
define(`PKG_DILFAT&#039;,
`define(`MAXY&#039;, `eval(`$4&#039; / 2 * 100)&#039;)
define(`MAXX&#039;, `eval(`$5&#039; + 100)&#039;)
define(`CENTERX&#039;, `eval(MAXX / 2)&#039;)
Element(0x00 &quot;$1&quot; &quot;$2&quot; &quot;$3&quot; eval(CENTERX + 20) 100 3 100 0x00)
(
forloop(`i&#039;, 1, eval($4 / 2),
`PIN(50, eval(i * 100 -50), 70, 28, i)
&#039;)
forloop(`i&#039;, 1, eval($4 / 2),
`PIN(eval(MAXX -50), eval(MAXY - i * 100 +50), 70, 28, eval(i + $4/2))
&#039;)
ElementLine(0 0 0 MAXY 10)
ElementLine(0 MAXY MAXX MAXY 10)
ElementLine(MAXX MAXY MAXX 0 10)
ElementLine(0 0 eval(CENTERX - 50) 0 10)
ElementLine(eval(CENTERX + 50) 0 MAXX 0 10)
ElementArc(CENTERX 0 50 50 0 180 10)
Mark(50 50)
)&#039;)</pre>

<p>
Запустите <strong><code>gschem one.sch</code></strong> и установите атрибут <code>footprint</code> операционного усилителя в <em>DILFAT 8 300</em>. Затем запустите <strong><code>gsch2pcb project</code></strong> и <strong>gsch2pcb</strong> удалит элемент <em>DIL</em> из <em><code>board.pcb</code></em>, добавьте в <em><code>board.new.pcb</code></em> новый элемент <em>DILFAT</em> из своего m4-файла <em><code>pcb.inc</code></em>. Запустите <strong><code>pcb board.pcb</code></strong> и загрузите <em><code>board.new.pcb</code></em> в свою топологию. Поставьте новый элемент с более толстыми выводами на то место, что освободилось при удалении старого.
</p>

</div>
<!-- EDIT13 SECTION "Нестандартные m4-элементы" [76059-89014] -->
<h2 class="sectionedit14" id="многопользовательская_настройка">Многопользовательская настройка</h2>
<div class="level2">

<p>
Вышеприведённые примеры ориентированы на отдельного пользователя, чьи
проекты и личные библиотеки символов для <strong>gschem</strong> и элементов для <strong>pcb</strong>
находятся в его домашнем каталоге. Здесь же приводится способ
многопользовательской настройки для совместного использования ресурсов:
</p>
<ul>
<li class="level1"><div class="li"> Поместите собственные <em>файловые элементы</em> <strong>pcb</strong> для общего пользования, например, в <em><code>/usr/local/share/pcb/pcb-elements</code></em>. Сделайте так, чтобы программа <strong>gsch2pcb</strong> искала элементы в этом каталоге для каждого пользователя, добавив вот такую строку в <em><code>/etc/gsch2pcb</code></em> или <em><code>/usr/local/etc/gsch2pcb</code></em>: <pre class="code">elements-dir /usr/local/share/pcb/pcb-elements</pre>

<p>
 Если есть какие-то нестандартные файлы <em>m4-элементов</em> для общего пользования, например, <em><code>/usr/local/share/pcb/pcb.inc</code></em>, добавьте ещё одну строку в <em><code>/etc/gsch2pcb</code></em> или <em><code>/usr/local/etc/gsch2pcb</code></em>: 
</p>
<pre class="code">m4-file /usr/local/share/pcb/pcb.inc</pre>
</div>
</li>
<li class="level1"><div class="li"> Если <strong>pcb</strong> по умолчанию устанавливает файлы <strong>m4</strong> не в <em><code>/usr/local/share/pcb/m4</code></em>, <em><code>/usr/share/pcb/m4,</code></em> или <em><code>/usr/X11R6/lib/X11/pcb/m4</code></em>, сделайте место установки известным для каждого пользователя <strong>gsch2pcb</strong>, добавив в <em><code>/etc/gsch2pcb</code></em> или <em><code>/usr/local/etc/gsch2pcb</code></em> строку: <pre class="code">m4-pcbdir /путь/к/pcb/m4</pre>

<p>
 Если вместо <strong>m4</strong> используется <strong>gm4</strong>, то в файл <em><code>gsch2pcb</code></em> добавьте следующее: 
</p>
<pre class="code">m4-command gm4</pre>
</div>
</li>
<li class="level1"><div class="li"> Если в каком-нибудь каталоге есть нестандартные символы <strong>gschem</strong> для общего пользования, нужно изменить системный файл <em><code>system-gafrc</code></em>, добавив строки <code>component-library</code> для них.</div>
</li>
</ul>

<p>
После выполнения вышеуказанных действий пользователи получат доступ к общим
библиотекам и им останется только добавлять в файлы своих проектов
<em><code>project</code></em> строки <code>schematics</code> и <code>output-name</code>. Но к тому же им
ничто не мешает использовать и свои собственные, специфические для
пользователя и/или проекта, дополнительные библиотеки символов и элементов.
</p>

</div>
<!-- EDIT14 SECTION "Многопользовательская настройка" [89015-92061] -->
<h2 class="sectionedit15" id="создание_печатных_плат">Создание печатных плат</h2>
<div class="level2">

<p>
Учебник должен содержать и описание процесса производства печатных плат.
</p>

</div>

<h5 id="фотолитография">Фотолитография</h5>
<div class="level5">

<p>
Используйте меню <strong><em>Файл</em></strong> → <strong><em>Экспорт топологии</em></strong> → <strong><em>ps</em></strong> для
создания Postscript-файла, пригодного для печати на прозрачной плёнке.
Обратите внимание на наличие переключателей &#039;mirror&#039; (зеркально) и
&#039;ps-invert&#039; (инверсия ps), которые могут вам понадобиться в зависимости от
вашего способа производства.
</p>

<p>
Откройте ps-файл и напечатайте только те страницы, что необходимы вам для
производства. В нём много страниц, и многие могут быть вам не нужны.
</p>

<p>
Если окажется, что площадки и дорожки у вас не печатаются на одной странице
или размещены не на той стороне, нужно посмотреть настройки во вкладке
<strong><em>Файл</em></strong> → <strong><em>Настройки…</em></strong> → <strong><em>Слои</em></strong>, надлежащим образом
сгруппировать слои и поместить их на нужную сторону.
</p>

</div>

<h5 id="производство_на_станке">Производство на станке</h5>
<div class="level5">

<p>
<a href="http://www.lpkf.com" class="urlextern" title="http://www.lpkf.com" rel="nofollow">LPKF</a> (и может быть другие компании) имеют плоттеры
для печатных плат, понимающие <a href="geda-glossary.ru.html#gerber-файлы" class="wikilink1" title="geda-glossary.ru.html">Gerber-файлы</a>. Их можно
произвести, выбрав <strong><em>Файл</em></strong> → <strong><em>Экспорт топологии</em></strong> →
<strong><em>gerber</em></strong>, что приведёт к созданию множества файлов. Эти файлы можно
просматривать в <a href="http://geda.seul.org/tools/gerbv/index.html" class="urlextern" title="http://geda.seul.org/tools/gerbv/index.html" rel="nofollow">gerbv</a> и
сохранять оттуда их графическое представление. Если вы удовлетворены
полученными Gerber-файлами, просто отдайте их кому-нибудь, у кого в
распоряжении есть такое оборудование, и ждите, пока платы будут готовы!
</p>

</div>
<!-- EDIT15 SECTION "Создание печатных плат" [92062-] --><div class="footnotes">
<div class="fn"><sup><a href="#fnt__5" id="fn__5" class="fn_bot">5)</a></sup> 
<div class="content">Сообщения означают: «board.pcb сохранён как board.pcb.bak1. 1 элемент удалён из board.pcb. Добавлено 1 файловых элементов и 0 m4-элементов в board.pcb». — <em>Прим. перев.</em></div></div>
<div class="fn"><sup><a href="#fnt__6" id="fn__6" class="fn_bot">6)</a></sup> 
<div class="content">Сообщения гласят: «Найден заголовок cpinlist с именем соединения […]!» и «Нет элементов для добавления, так что не создаю board.new.pcb». — <em>Прим. перев.</em></div></div>
</div>
</body>
</html>
